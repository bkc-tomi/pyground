from pyground.tests import CommonTestCase
from django.urls    import reverse


# モデル
from bookmark.models   import Bookmark
from friend.models     import Follow, Permit
from playground.models import Code
from question.models   import Question, Correcter
from user.models       import User, Profile

# templateのあるviewのみテスト
# POST処理等は取りあえすしない

class FollowViewTest(CommonTestCase):
    """
    ----------------------------------------------------------------------
    フレンド／フォロー一覧
    ----------------------------------------------------------------------
    """
    def test_show_follow(self):
        """
        ----------------------------------------------------------------
        ** テスト内容 **
        フォロワーを表示

        ** 入力値 **
        user1, user2, user3
        user1 -> user2,  user1 -> user3
        ** 期待値 **
        user_id      : user.id
        follow_list: "{'id': 1, 'user': <User: 2>}", "{'id': 2, 'user': <User: 3>}"
        ----------------------------------------------------------------
        """
        # データ作成 ------------------------------------------------

        # 実行 -----------------------------------------------------

        # テスト ---------------------------------------------------

    def test_show_no_follow(self):
        """
        ----------------------------------------------------------------
        ** テスト内容 **

        ** 入力値 **
        
        ** 期待値 **
        
        ----------------------------------------------------------------
        """
        # データ作成 ------------------------------------------------

        # 実行 -----------------------------------------------------

        # テスト ---------------------------------------------------


    def test_redirect(self):
        """
        ----------------------------------------------------------------
        ** テスト内容 **
        ユーザーがログインしてない状態でのリダイレクト

        ** 入力値 **
        login_user
        ** 期待値 **
        リダイレクト先: top:top
        ----------------------------------------------------------------
        """
        # データ作成 ------------------------------------------------
        user = self.make_user("usr1", "aa@bb.jp", "1234")

        # 実行 -----------------------------------------------------
        response = self.client.get(reverse('friend:follow', args=(user.id, )))

        # テスト ---------------------------------------------------
        self.assertRedirects(
            response,
            expected_url=reverse('top:top'),
            status_code=302,
            target_status_code=200,
        )


class FollowerViewTest(CommonTestCase):
    """
    ----------------------------------------------------------------------
    フレンド／フォロワー一覧
    ----------------------------------------------------------------------
    """
    def test_show_follower(self):
        """
        ----------------------------------------------------------------
        ** テスト内容 **

        ** 入力値 **
        
        ** 期待値 **
        
        ----------------------------------------------------------------
        """
        # データ作成 ------------------------------------------------

        # 実行 -----------------------------------------------------

        # テスト ---------------------------------------------------
    
    def test_show_no_follower(self):
        """
        ----------------------------------------------------------------
        ** テスト内容 **

        ** 入力値 **
        
        ** 期待値 **
        
        ----------------------------------------------------------------
        """
        # データ作成 ------------------------------------------------

        # 実行 -----------------------------------------------------

        # テスト ---------------------------------------------------
        

    def test_redirect(self):
        """
        ----------------------------------------------------------------
        ** テスト内容 **
        ユーザーがログインしてない状態でのリダイレクト

        ** 入力値 **
        login_user
        ** 期待値 **
        リダイレクト先: top:top
        ----------------------------------------------------------------
        """
        # データ作成 ------------------------------------------------
        user = self.make_user("usr1", "aa@bb.jp", "1234")

        # 実行 -----------------------------------------------------
        response = self.client.get(reverse('friend:follower', args=(user.id, )))

        # テスト ---------------------------------------------------
        self.assertRedirects(
            response,
            expected_url=reverse('top:top'),
            status_code=302,
            target_status_code=200,
        )


class RunFollowViewTest(CommonTestCase):
    """
    ----------------------------------------------------------------------
    フレンド／フォロー処理
    ----------------------------------------------------------------------
    """
    def test_follow(self):
        """
        ----------------------------------------------------------------
        ** テスト内容 **

        ** 入力値 **
        
        ** 期待値 **
        
        ----------------------------------------------------------------
        """
        # データ作成 ------------------------------------------------

        # 実行 -----------------------------------------------------

        # テスト ---------------------------------------------------

    def test_follow_with_no_user(self):
        """
        ----------------------------------------------------------------
        ** テスト内容 **

        ** 入力値 **
        
        ** 期待値 **
        
        ----------------------------------------------------------------
        """
        # データ作成 ------------------------------------------------

        # 実行 -----------------------------------------------------

        # テスト ---------------------------------------------------

    def test_redirect(self):
        """
        ----------------------------------------------------------------
        ** テスト内容 **
        ユーザーがログインしてない状態でのリダイレクト

        ** 入力値 **
        login_user
        ** 期待値 **
        リダイレクト先: top:top
        ----------------------------------------------------------------
        """
        # データ作成 ------------------------------------------------
        u1 = self.make_user("usr1", "aa@bb.jp", "1234")
        u2 = self.make_user("usr2", "bb@bb.jp", "1234")

        f = self.make_relation(u1.id, u2.id)

        # 実行 -----------------------------------------------------
        response = self.client.get(reverse('friend:run_follow', args=(u2.id, )))

        # テスト ---------------------------------------------------
        self.assertRedirects(
            response,
            expected_url=reverse('top:top'),
            status_code=302,
            target_status_code=200,
        )


class ReleaseViewTest(CommonTestCase):
    """
    ----------------------------------------------------------------------
    フレンド／フォロー解除処理
    ----------------------------------------------------------------------
    """
    def test_release(self):
        """
        ----------------------------------------------------------------
        ** テスト内容 **

        ** 入力値 **
        
        ** 期待値 **
        
        ----------------------------------------------------------------
        """
        # データ作成 ------------------------------------------------

        # 実行 -----------------------------------------------------

        # テスト ---------------------------------------------------

    def test_release_with_no_follow_id(self):
        """
        ----------------------------------------------------------------
        ** テスト内容 **

        ** 入力値 **
        
        ** 期待値 **
        
        ----------------------------------------------------------------
        """
        # データ作成 ------------------------------------------------

        # 実行 -----------------------------------------------------

        # テスト ---------------------------------------------------

    def test_redirect(self):
        """
        ----------------------------------------------------------------
        ** テスト内容 **
        ユーザーがログインしてない状態でのリダイレクト

        ** 入力値 **
        login_user
        ** 期待値 **
        リダイレクト先: top:top
        ----------------------------------------------------------------
        """
        # データ作成 ------------------------------------------------
        u1 = self.make_user("usr1", "aa@bb.jp", "1234")
        u2 = self.make_user("usr2", "bb@bb.jp", "1234")

        f = self.make_relation(u1.id, u2.id)

        # 実行 -----------------------------------------------------
        response = self.client.get(reverse('friend:release', args=(f.id, )))

        # テスト ---------------------------------------------------
        self.assertRedirects(
            response,
            expected_url=reverse('top:top'),
            status_code=302,
            target_status_code=200,
        )


class PermitViewTest(CommonTestCase):
    """
    ----------------------------------------------------------------------
    フレンド／フォロー許可ページ
    ----------------------------------------------------------------------
    """
    def test_show_permit(self):
        """
        ----------------------------------------------------------------
        ** テスト内容 **

        ** 入力値 **
        
        ** 期待値 **
        
        ----------------------------------------------------------------
        """
        # データ作成 ------------------------------------------------

        # 実行 -----------------------------------------------------

        # テスト ---------------------------------------------------

    def test_show_no_permit(self):
        """
        ----------------------------------------------------------------
        ** テスト内容 **

        ** 入力値 **
        
        ** 期待値 **
        
        ----------------------------------------------------------------
        """
        # データ作成 ------------------------------------------------

        # 実行 -----------------------------------------------------

        # テスト ---------------------------------------------------

    def test_redirect(self):
        """
        ----------------------------------------------------------------
        ** テスト内容 **
        ユーザーがログインしてない状態でのリダイレクト

        ** 入力値 **
        login_user
        ** 期待値 **
        リダイレクト先: top:top
        ----------------------------------------------------------------
        """
        # データ作成 ------------------------------------------------
        user = self.make_user("usr1", "aa@bb.jp", "1234")

        # 実行 -----------------------------------------------------
        response = self.client.get(reverse('friend:permit', args=(user.id, )))

        # テスト ---------------------------------------------------
        self.assertRedirects(
            response,
            expected_url=reverse('top:top'),
            status_code=302,
            target_status_code=200,
        )


class RunPermitViewTest(CommonTestCase):
    """
    ----------------------------------------------------------------------
    フレンド／フォロー許可処理
    ----------------------------------------------------------------------
    """
    def test_permit(self):
        """
        ----------------------------------------------------------------
        ** テスト内容 **

        ** 入力値 **
        
        ** 期待値 **
        
        ----------------------------------------------------------------
        """
        # データ作成 ------------------------------------------------

        # 実行 -----------------------------------------------------

        # テスト ---------------------------------------------------

    def test_permit_with_no_permit_id(self):
        """
        ----------------------------------------------------------------
        ** テスト内容 **

        ** 入力値 **
        
        ** 期待値 **
        
        ----------------------------------------------------------------
        """
        # データ作成 ------------------------------------------------

        # 実行 -----------------------------------------------------

        # テスト ---------------------------------------------------


    def test_redirect(self):
        """
        ----------------------------------------------------------------
        ** テスト内容 **
        ユーザーがログインしてない状態でのリダイレクト

        ** 入力値 **
        login_user
        ** 期待値 **
        リダイレクト先: top:top
        ----------------------------------------------------------------
        """
        # データ作成 ------------------------------------------------
        u1 = self.make_user("usr1", "aa@bb.jp", "1234")
        u2 = self.make_user("usr2", "bb@bb.jp", "1234")

        p = self.make_permit(u1.id, u2.id)

        # 実行 -----------------------------------------------------
        response = self.client.get(reverse('friend:run_permit', args=(p.id, )))

        # テスト ---------------------------------------------------
        self.assertRedirects(
            response,
            expected_url=reverse('top:top'),
            status_code=302,
            target_status_code=200,
        )


class RunNoPermitViewTest(CommonTestCase):
    """
    ----------------------------------------------------------------------
    フレンド／フォロー不許可処理
    ----------------------------------------------------------------------
    """
    def test_nopermit(self):
        """
        ----------------------------------------------------------------
        ** テスト内容 **

        ** 入力値 **
        
        ** 期待値 **
        
        ----------------------------------------------------------------
        """
        # データ作成 ------------------------------------------------

        # 実行 -----------------------------------------------------

        # テスト ---------------------------------------------------

    def test_nopermit_with_no_permit_id(self):
        """
        ----------------------------------------------------------------
        ** テスト内容 **

        ** 入力値 **
        
        ** 期待値 **
        
        ----------------------------------------------------------------
        """
        # データ作成 ------------------------------------------------

        # 実行 -----------------------------------------------------

        # テスト ---------------------------------------------------

    def test_redirect(self):
        """
        ----------------------------------------------------------------
        ** テスト内容 **
        ユーザーがログインしてない状態でのリダイレクト

        ** 入力値 **
        login_user
        ** 期待値 **
        リダイレクト先: top:top
        ----------------------------------------------------------------
        """
        # データ作成 ------------------------------------------------
        u1 = self.make_user("usr1", "aa@bb.jp", "1234")
        u2 = self.make_user("usr2", "bb@bb.jp", "1234")

        p = self.make_permit(u1.id, u2.id)

        # 実行 -----------------------------------------------------
        response = self.client.get(reverse('friend:run_nopermit', args=(p.id, )))

        # テスト ---------------------------------------------------
        self.assertRedirects(
            response,
            expected_url=reverse('top:top'),
            status_code=302,
            target_status_code=200,
        )